<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customer Service</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
            line-height: 1.6;
        }

        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
        }

        header {
            background: #7ba0ca;
            color: #fff;
            padding-top: 30px;
            min-height: 70px;
            border-bottom: #77aaff 3px solid;
        }

        header a {
            color: #fff;
            text-decoration: none;
            text-transform: uppercase;
            font-size: 16px;
        }

        header ul {
            padding: 0;
            list-style: none;
        }

        header li {
            float: left;
            display: inline;
            padding: 0 20px 0 20px;
        }

        header #branding {
            float: left;
        }

        header #branding h1 {
            margin: 0;
        }

        header nav {
            float: right;
            margin-top: 10px;
        }

        #showcase {
            min-height: 400px;
            background: url('customer-service-background.jpg') no-repeat center center;
            background-size: cover;
            text-align: center;
            color: #040104;
        }

        #showcase h1 {
            margin-top: 100px;
            font-size: 55px;
            margin-bottom: 10px;
        }

        #showcase p {
            font-size: 20px;
        }

        .content {
            padding: 20px;
            background: #dcd4d800;
        }

        .content h2 {
            margin-top: 0;
        }

        .contact-info {
            display: flex;
            flex-wrap: wrap;
        }

        .contact-info div {
            flex: 1;
            padding: 20px;
            box-sizing: border-box;
        }

        .faq {
            margin-top: 20px;
        }

        .faq h3 {
            margin-bottom: 10px;
        }

        .faq p {
            margin: 0 0 20px;
        }

        footer {
            padding: 1rem 0rem;
            margin-top: 20px;
            color: #fff;
            background-color: #7ba0ca;
            text-align: center;
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <div id="branding">
                <h1>Seven Light Market</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="paige.html">Back to buy</a></li>
                    <li><a href="history.html">History</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section id="showcase">
        <div class="container">
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
                integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
                crossorigin="anonymous">
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
                crossorigin="anonymous"></script>
            <link rel="stylesheet" href="list.css">

            <div class="container">
                <h3>
                    <br>
                </h3>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="invoice-title">
                            <h2>Invoice</h2>
                            <h3 class="pull-right">Order # 12345</h3>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-xs-6">
                                <address>
                                    <strong>Address: 24 Yehuda Halevi</strong><br>
                                    Phone: 0547369800
                                    <br>
                                    Netanya
                                </address>
                            </div>
                            <div class="col-xs-6 text-right">
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-6">
                                <address>
                                    <div id="user-email"></div>
                                </address>
                            </div>
                            <div class="col-xs-6 text-right">
                                <address>
                                    <strong> Date:</strong><br>
                                    <div id="buy-date">18/06/2024</div><br>
                                </address>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                <h3 class="panel-title"><strong>order description</strong></h3>
                            </div>
                            <div class="panel-body">
                                <div class="table-responsive">
                                    <table class="table table-condensed">
                                        <thead>
                                            <tr>
                                                <td><strong>Item</strong></td>
                                                <td class="text-center"><strong>Price</strong></td>
                                                <td class="text-center"><strong>Quantity</strong></td>
                                                <td class="text-right"><strong>sum</strong></td>
                                            </tr>
                                        </thead>
                                        <tbody id="invoice-body">
                                            <tr>
                                                <td>Carrot</td>
                                                <td class="text-center">nis2.00</td>
                                                <td class="text-center" id="carrot-quantity"></td>
                                                <td class="text-right" id="carrot-sum"></td>
                                            </tr>
                                            <tr>
                                                <td>Tomato</td>
                                                <td class="text-center">nis1.50</td>
                                                <td class="text-center" id="tomato-quantity"></td>
                                                <td class="text-right" id="tomato-sum"></td>
                                            </tr>
                                            <tr>
                                                <td>Pumpkin</td>
                                                <td class="text-center">nis3.00</td>
                                                <td class="text-center" id="pumpkin-quantity"></td>
                                                <td class="text-right" id="pumpkin-sum"></td>
                                            </tr>
                                            <tr>
                                                <td>Eggplant</td>
                                                <td class="text-center">nis4.00</td>
                                                <td class="text-center" id="eggplant-quantity"></td>
                                                <td class="text-right" id="eggplant-sum"></td>
                                            </tr>
                                            <tr>
                                                <td>Apple</td>
                                                <td class="text-center">nis2.50</td>
                                                <td class="text-center" id="apple-quantity"></td>
                                                <td class="text-right" id="apple-sum"></td>
                                            </tr>
                                            <tr>
                                                <td>Banana</td>
                                                <td class="text-center">nis5.00</td>
                                                <td class="text-center" id="banana-quantity"></td>
                                                <td class="text-right" id="banana-sum"></td>
                                            </tr>
                                            <tr>
                                                <td>Orange</td>
                                                <td class="text-center">nis7.00</td>
                                                <td class="text-center" id="orange-quantity"></td>
                                                <td class="text-right" id="orange-sum"></td>
                                            </tr>
                                            <tr>
                                                <td class="thick-line"></td>
                                                <td class="thick-line"></td>
                                                <td class="thick-line text-center"><strong>Subtotal</strong></td>
                                                <td class="thick-line text-right" id="subtotal"></td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-center"><strong>Tax</strong></td>
                                                <td class="no-line text-right" id="tax"></td>
                                            </tr>
                                            <tr>
                                                <td class="no-line"></td>
                                                <td class="no-line"></td>
                                                <td class="no-line text-center"><strong>for payment</strong></td>
                                                <td class="no-line text-right" id="total"></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <footer>
                <p>
                    <strong> Store hours:</strong><br>
                    Sunday-Tuesday 7:00-20:00 <br>
                    Wed-Thurs 7:00-24:00 <br>
                    Saturday and holiday evenings 7:00-14:30
                </p>
            </footer>
        </div>
    </section>

    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const email = localStorage.getItem('userEmail');
            const firstName = localStorage.getItem('firstName');
            const lastName = localStorage.getItem('lastName');

            const userEmailElement = document.getElementById('user-email');
            if (email) {
                userEmailElement.textContent = "Invoice for "+firstName+" "+lastName +" ("+ email+")";
            }
        });

        function updateItems(shoppingList) {
            let subtotal = 0;

            const carrotQuantity = shoppingList['carrot'];
            const carrotSum = 2 * carrotQuantity;
            subtotal += carrotSum;
            document.getElementById('carrot-quantity').textContent = carrotQuantity;
            document.getElementById('carrot-sum').textContent = `nis${carrotSum.toFixed(2)}`;

            const tomatoQuantity = shoppingList['tomato'];
            const tomatoSum = 1.5 * tomatoQuantity;
            subtotal += tomatoSum;
            document.getElementById('tomato-quantity').textContent = tomatoQuantity;
            document.getElementById('tomato-sum').textContent = `nis${tomatoSum.toFixed(2)}`;

            const pumpkinQuantity = shoppingList['pumpkin'];
            const pumpkinSum = 3 * pumpkinQuantity;
            subtotal += pumpkinSum;
            document.getElementById('pumpkin-quantity').textContent = pumpkinQuantity;
            document.getElementById('pumpkin-sum').textContent = `nis${pumpkinSum.toFixed(2)}`;

            const eggplantQuantity = shoppingList['eggplant'];
            const eggplantSum = 4 * eggplantQuantity;
            subtotal += eggplantSum;
            document.getElementById('eggplant-quantity').textContent = eggplantQuantity;
            document.getElementById('eggplant-sum').textContent = `nis${eggplantSum.toFixed(2)}`;

            const appleQuantity = shoppingList['apple'];
            const appleSum = 2.5 * appleQuantity;
            subtotal += appleSum;
            document.getElementById('apple-quantity').textContent = appleQuantity;
            document.getElementById('apple-sum').textContent = `nis${appleSum.toFixed(2)}`;

            const bananaQuantity = shoppingList['banana'];
            const bananaSum = 5 * bananaQuantity;
            subtotal += bananaSum;
            document.getElementById('banana-quantity').textContent = bananaQuantity;
            document.getElementById('banana-sum').textContent = `nis${bananaSum.toFixed(2)}`;

            const orangeQuantity = shoppingList['orange'];
            const orangeSum = 7 * orangeQuantity;
            subtotal += orangeSum;
            document.getElementById('orange-quantity').textContent = orangeQuantity;
            document.getElementById('orange-sum').textContent = `nis${orangeSum.toFixed(2)}`;

            const taxRate = 0.17; // Assuming 17% tax rate
            const tax = subtotal * taxRate;
            const total = subtotal + tax;

            document.getElementById('subtotal').textContent = `nis${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `nis${tax.toFixed(2)}`;
            document.getElementById('total').textContent = `nis${total.toFixed(2)}`;

            let date = new Date(Date.now());
            date = date.toString().substring(0, 25);
            document.getElementById('buy-date').textContent = `${date}`;
        }

        async function listVegtables(id) {
            const url = `http://127.0.0.1:3004/ShoppingList?id=${id}`;
            const response = await fetch(url, {
                method: "GET",
                mode: "cors",
                headers: {
                    "Content-Type": "application/json"
                },
            });

            const shoppingList = await response.json();
            updateItems(shoppingList);

            if (response.status === 200) {
                console.log("It is OK");
            } else {
                console.error("Failed to fetch shopping list");
            }
        }

        let queryString = window.location.search;
        queryString = queryString.split('=')[1];
        listVegtables(queryString);
    </script>
</body>

</html>
